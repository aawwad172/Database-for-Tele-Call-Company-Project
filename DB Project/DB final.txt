CREATE TABLE CUSTOMERS(
ID number(2) CONSTRAINT CUST_ID_PK PRIMARY KEY,
SSN number(9) UNIQUE,
phoneNumber number(10) unique,
Address varchar2(30) NOT NULL,
FirstName varchar2(15) NOT NULL,
LastName varchar2(15) NOT NULL,
FullName varchar2(31) GENERATED ALWAYS AS (FIRSTNAME || ' ' || LASTNAME) VIRTUAL
);

CREATE TABLE BILL(
BILL_ID NUMBER(2) CONSTRAINT BILL_ID_PK PRIMARY KEY,
PRICE NUMBER(3) NOT NULL,
SUBSCRIPTION_TYPE VARCHAR2(15) NOT NULL,
C_ID NUMBER(2),
CONSTRAINT C_ID_FK FOREIGN KEY (C_ID) REFERENCES CUSTOMERS(ID) ON DELETE SET NULL
);

CREATE TABLE SUBSCRIPTION(
DESCRIPTION VARCHAR2(30) NOT NULL,
SUP_NAME VARCHAR2(15) NOT NULL,
DATE_OF_PURCHASE DATE NOT NULL,
SUB_PRICE NUMBER(3) NOT NULL,
C_ID NUMBER(2),
BILL_ID NUMBER(2),
CONSTRAINT SUB_C_ID_FK FOREIGN KEY (C_ID) REFERENCES CUSTOMERS(ID) ON DELETE SET NULL,
CONSTRAINT BILL_ID_FK FOREIGN KEY (BILL_ID) REFERENCES BILL(BILL_ID) ON DELETE CASCADE
);

CREATE TABLE DEPARTMENT(
DEP_NAME VARCHAR2(20) NOT NULL,
DEP_ID NUMBER(2) CONSTRAINT DEP_ID_PK PRIMARY KEY);

CREATE TABLE EMPLOYEE(
EMP_ID NUMBER(2) CONSTRAINT EMP_ID_PK PRIMARY KEY,
BIRTHDATE DATE NOT NULL,
EMAIL VARCHAR2(20) NOT NULL,
SALARY NUMBER(5) NOT NULL,
EMP_SSN NUMBER(10) UNIQUE,
EMP_FIRSTNAME VARCHAR2(15) NOT NULL,
EMP_LASTNAME VARCHAR2(15) NOT NULL,
EMP_FULLNAME VARCHAR2(31) GENERATED ALWAYS AS (EMP_FIRSTNAME || ' ' ||EMP_LASTNAME) VIRTUAL,
DEP_ID NUMBER(2),
CONSTRAINT DEP_ID_FK FOREIGN KEY (DEP_ID) REFERENCES DEPARTMENT(DEP_ID) ON DELETE CASCADE
);

CREATE TABLE PROJECT(
PROJECT_ID NUMBER(2) CONSTRAINT PROJECT_ID_PK PRIMARY KEY,
PROJECT_NAME VARCHAR2(10) NOT NULL,
BUDGET NUMBER(6) NOT NULL,
DEP_ID NUMBER(2),
CONSTRAINT PROJECT_ID_FK FOREIGN KEY (DEP_ID) REFERENCES DEPARTMENT(DEP_ID) ON DELETE CASCADE
);

CREATE TABLE HAS_A (
ID NUMBER(2) CONSTRAINT HAS_A_ID_PK PRIMARY KEY,
CONSTRAINT CUSTOMER_ID_FK FOREIGN KEY (CUSTOMER_ID) REFERENCES CUSTOMERS(ID) ON DELETE CASCADE
);

INSERT INTO DEPARTMENT VALUES('HR',1);
INSERT INTO DEPARTMENT VALUES('ACCOUNTING',2);
INSERT INTO DEPARTMENT VALUES('SALES',3);
INSERT INTO DEPARTMENT VALUES('CUSTOMER SERVICE',4);
INSERT INTO DEPARTMENT VALUES('MANAGMENT',5);

INSERT INTO CUSTOMERS(ID,SSN,PHONENUMBER,ADDRESS,FIRSTNAME,LASTNAME) VALUES(1,202201,0786003901,'Amman','mohammad','khaled');
INSERT INTO CUSTOMERS(ID,SSN,PHONENUMBER,ADDRESS,FIRSTNAME,LASTNAME) VALUES(2,202202,0786003902,'Irbid','Ahmad','essa');
INSERT INTO CUSTOMERS(ID,SSN,PHONENUMBER,ADDRESS,FIRSTNAME,LASTNAME) VALUES(3,202203,0786003903,'Zarqa','Khaled','mohammad');
INSERT INTO CUSTOMERS(ID,SSN,PHONENUMBER,ADDRESS,FIRSTNAME,LASTNAME) VALUES(4,202204,0786003904,'Zarqa','Ghayth','zakaria');
INSERT INTO CUSTOMERS(ID,SSN,PHONENUMBER,ADDRESS,FIRSTNAME,LASTNAME) VALUES(5,202205,0786003905,'Amman','Salem','Khaleel');

INSERT INTO BILL VALUES(1,20,'4G',3);
INSERT INTO BILL VALUES(2,25,'FIBER',2);
INSERT INTO BILL VALUES(3,22,'DSL',5);
INSERT INTO BILL VALUES(4,10,'MIFI',1);
INSERT INTO BILL VALUES(5,35,'5G',4);

INSERT INTO SUBSCRIPTION VALUES('FIBER 50MBPS UNLIMITED DOWNLOAD','FIBER','12-DEC-2019',25,2,2);
INSERT INTO SUBSCRIPTION VALUES('MIFI 100GP 3MBPS','MIFI','10-OCT-2014',10,1,4);
INSERT INTO SUBSCRIPTION VALUES('5G 200MBPS UNLIMITED DOWLOAD','5G','1-JAN-2022',35,4,1);
INSERT INTO SUBSCRIPTION VALUES('DSL 24MBPS 1000GB DOWNLOAD','DSL','12-FEB-2018',22,5,3);
INSERT INTO SUBSCRIPTION VALUES('4G 15MBPS 1000GB DOWNLOAD','4G','12-DEC-2019',20,3,1);


UPDATE CUSTOMERS
SET Address = 'New Address'
WHERE ID = 1;


DELETE FROM SUBSCRIPTION
WHERE SUP_NAME = 'Company A';


SELECT CUSTOMERS.FirstName, CUSTOMERS.LastName, BILL.PRICE
FROM CUSTOMERS
JOIN BILL
ON CUSTOMERS.ID = BILL.C_ID
WHERE BILL.PRICE > 55;


SELECT DEPARTMENT.DEP_NAME, COUNT(EMPLOYEE.EMP_ID)
FROM DEPARTMENT
JOIN EMPLOYEE
ON DEPARTMENT.DEP_ID = EMPLOYEE.DEP_ID
GROUP BY DEPARTMENT.DEP_NAME
HAVING COUNT(EMPLOYEE.EMP_ID) > 1;
